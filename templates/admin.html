<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Admin - Intégrale Academy</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <div class="admin-header">
    <img src="/static/logo.png" alt="Logo Intégrale Academy">
    <h1>Interface Admin - Intégrale Academy</h1>
  </div>

  <!-- Messages flash -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div style="margin:15px; padding:10px; border-radius:5px; background:#d4edda; color:#155724; border:1px solid #c3e6cb;">
        {% for category, message in messages %}
          <p>{{ message }}</p>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <table>
    <thead>
      <tr>
        <th>Nom</th>
        <th>Prénom</th>
        <th>Email</th>
        <th colspan="4">Dossier</th>
      </tr>
    </thead>
    <tbody>
      {% for row in data %}
      <tr>
        <td>{{ row.nom }}</td>
        <td>{{ row.prenom }}</td>
        <td>{{ row.email }}</td>
        <td colspan="4">
          <form method="post" action="/update/{{ row.prenom }}/{{ row.nom }}" class="actions">
            <select name="status_select">
              <option value="INCOMPLET" {% if row.status == 'INCOMPLET' %}selected{% endif %}>INCOMPLET</option>
              <option value="COMPLET" {% if row.status == 'COMPLET' %}selected{% endif %}>COMPLET</option>
              <option value="CONFORME" {% if row.status == 'CONFORME' %}selected{% endif %}>CONFORME</option>
              <option value="NON CONFORME" {% if row.status == 'NON CONFORME' %}selected{% endif %}>NON CONFORME</option>
            </select>

            <input type="text" name="commentaire" value="{{ row.commentaire }}" placeholder="Commentaire">

            <a href="/download/{{ row.folder }}" class="btn download">📁 Télécharger</a>
            <a href="/fiche/{{ row.prenom }}/{{ row.nom }}" class="btn pdf">📄 Fiche PDF</a>
            <a href="/mail/{{ row.prenom }}/{{ row.nom }}" class="btn" style="background:#007bff;color:white;">📧 Voir mail</a>

            <button type="submit" class="btn save">💾 Enregistrer</button>
            <button type="submit" name="status" value="CONFORME" class="btn" style="background:green;color:white;">✔️ Conforme</button>
            <button type="submit" name="status" value="NON CONFORME" class="btn" style="background:red;color:white;">❌ Non Conforme</button>
          </form>

          <form method="post" action="/delete/{{ row.prenom }}/{{ row.nom }}" class="actions" style="margin-top: 10px;">
            <button type="submit" class="btn delete">🗑️ Supprimer</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>
